<body>
  <!DOCTYPE html>
<html lang="en-us">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta content="" name="keywords">
<meta content="【趣味向】MATLAB 实现函数卷积演示动画 - 宇宙よりも遠い場所" property="og:title">
<title>【趣味向】MATLAB 实现函数卷积演示动画 | 宇宙よりも遠い場所</title>
<script src="https://unpkg.com/muse-player/dist/assets/muse-player.js"></script>
<link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">
<link rel="stylesheet" href="https://kirainmoe.com//css/style.css">
<link rel="stylesheet" href="https://kirainmoe.com//css/custom.css">
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" integrity="sha384-9tPv11A+glH/on/wEu99NVwDPwkMQESOocs/ZGXPoIiLE8MU/qkqUcZ3zzL+6DuH" crossorigin="anonymous">
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none", 
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [["$", "$"], ["\\(", "\\)"]],
          displayMath: [["$$", "$$"], ["\\[", "\\]"]],
          skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"]
        },
        "HTML-CSS": {
          availableFonts: ["STIX", "TeX"], 
          showMathMenu: false
        }
	  });
</script>
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

<style type="text/css">
	.nav-left {	display: block; text-align: left; }
	.nav-link { display: inline-block; margin: 0px 20px 0px 0px;  }
	.nav-item { justify-content: flex-start;  }
	.nav-title { margin: 0px; font-size: 28px; font-weight: bold;  }
	.nav-title a { padding: 10px 0px;  }
	@media screen and (max-width: 700px) {
		.nav { display: block; text-align: center;  }
		.nav-title > .nav-item { display: block;  text-align: center; }
		.nav-left { text-align: center;  }
	}
</style>

  <section class="section navigator">
  <div class="navigator-background"></div>
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <h1 class="nav-title"><a class="nav-item" href="https://kirainmoe.com/">宇宙よりも遠い場所</a></h1>
        <div class="nav-links">
          <a class="nav-link" href="/pages/guestbook/">Guestbook</a>
          <a class="nav-link" href="/pages/friends/">Friends</a>        
          <a class="nav-link" href="https://about.me/kirainmoe">About</a>
        </div>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile">
          
          <a class="level-item" href="https://github.com/kirainmoe">
            <span class="icon">
              <i class="fa fa-github"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://weibo.com/returnnnn">
            <span class="icon">
              <i class="fa fa-weibo"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://acm.kirainmoe.com">
            <span class="icon">
              <i class="fa fa-tumblr"></i>
            </span>
          </a>
          
          <a class="level-item" href="/index.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>
          </a>
          
        </nav>
      </div>
    </nav>
  </div>
</section>

<div class="return-top">
  <i class="fa fa-angle-up"></i>
</div>

<div class="loading-progress"></div>
  <section class="section content-container">
    <div class="container article-here">
      <h2 class="subtitle is-6">November 23, 2019</h2>
      <h1 class="title">【趣味向】MATLAB 实现函数卷积演示动画</h1>
      
      <div class="tags">
    
        <a class="button is-link" href="/tags/matlab">matlab</a>
    
        <a class="button is-link" href="/tags/experiment">experiment</a>
    
</div>

      
      <div class="content">
        <p>这件事要从上一节的信号与系统实验课说起。在老师把连续函数卷积的内容讲完布置作业的时候，他给我们整了一个好活……</p>

<blockquote>
<p>“除了上面这些作业之外，要求大家额外做一个附加题，来实现两个函数图解法求卷积动画演示。”</p>
</blockquote>

<p>差不多像这样子（$f_1(t) = u(t) - u(t-2), f_2(t) = u(t-1) - u(t-3), f_1 * f_2$）：</p>

<p><img src="https://i.loli.net/2019/11/23/3NHmXJZhRqckQa4.gif" alt="bandicam 2019-11-23 12-44-47-680.gif" /></p>

<p>然而我们既不知道这东西具体如何实现，也并没有学过怎么用 MATLAB 做动画，那咋办嘛。</p>

<blockquote>
<p>老师：“我希望每个人都要做这个附加题，<strong>有 问 题 自 己 去 解 决</strong>。”</p>
</blockquote>

<p>反正当时我的表情是这样的：</p>

<p><img src="https://i.loli.net/2019/11/23/rB3LbTUwgOCQJvY.png" alt="TIM截图20191123125051.png" /></p>

<p>好呗，既然整了这么个好活，那我们就来看看这东西到底咋搞咯。</p>

<h1 id="前置知识">前置知识</h1>

<h2 id="图解法求卷积">图解法求卷积</h2>

<p>定义：函数 $f_1(t)$ 和 $f_2(t)$ 的卷积 $f_1(t) * f_2(t) = \int _{-\infty}^{\infty} f_1(\tau)f_2(t-\tau) d\tau$.</p>

<p>为了求解 $f_1(t) * f_2(t)$，我们可以使用图解法，将卷积运算中一些抽象的关系形象化。具体有以下几个步骤：</p>

<ol>
<li>换元：将横坐标变元由 $t$ 变换为 $\tau$：$f_1(t) \to f_1(\tau)$，$f_2(t) \to f_2(\tau)$</li>
<li>固定其中一个信号（如 $f_2(\tau)$），对另一个信号关于纵轴反折：$f_1(\tau) \to f_1(-\tau)$</li>
<li>位移：将反折后的信号做位移，位移量是 $t$：$f_1(-\tau) \to f_1(t-\tau)$。首先将 $f_1$ 左移到与 $f_2$ 不重合的位置</li>
<li>增大 $t$，将 $f_1$ 向右移动，使得 $f_1(t-\tau)$ 和 $f_2(\tau)$ 发生重叠，将两信号重叠的部分相乘：$f_1(t-\tau)f_2(\tau)$</li>
<li>积分：两个信号在该点重叠部分的面积 $\int _{-\infty} ^{\infty}f_1(t-\tau)f_2(\tau) d\tau$ 即为 $f_1 * f_2$ 在点 $t$ 处的函数值</li>
</ol>

<h2 id="matlab-创建动画">MATLAB 创建动画</h2>

<p>所谓动画，就是很多张静态图片，以一定帧数播放而产生的动态效果。</p>

<p>而在 MATLAB 里创建动画的基本原理，也是将使用 plot 等函数绘出来的结果一张张地保存，然后一帧帧地播放，就能产生动态的动画。MATLAB 对此功能的实现提供了一些关键函数，如 <code>getframe, movie</code> 等。</p>

<p>当然，也可以在循环绘图的时候直接指定短暂的停留时间，以此产生动画。可以使用 <code>pause</code> 函数产生短暂的停留。</p>

<h1 id="思路分析">思路分析</h1>

<p>大概有人会说，这不是按照上面图解法的步骤一步一步来就好了嘛。</p>

<p><img src="https://i.loli.net/2019/11/23/ABVwao46OPxfuEK.jpg" alt="46CE3F2663B1474DE1F9438A5C64D5A2.jpg" /></p>

<p>这样吧，我们最终的目的是要弄出一个动画对吧，这个动画呢它是一帧帧、一张张图组成的，那我们先绘出所有时刻的图吧。</p>

<p>那绘出所有时刻的图，跟画某个时刻的图的区别就在于，其中一个函数会从左到右逐渐平移咯。</p>

<p>对于 $f_1(t-\tau)$ 而言，从左到右平移就相当于将 $t$ 逐渐由小增大。那么我们要实现平移的效果，只要让 $t$ 缓慢、线性地从一个小值 $from$ 变到一个大值 $end$ 就可以了。</p>

<p>然后我们对每个 $t_0$ 值都画一幅 $f_1(t_0-\tau)$ 的图，并且计算 $f_{13}(t) = f_1(t_0-\tau) \cdot f_2(\tau)$ 在 $(-\infty, \infty)$ 的积分值 $f_{14}$，</p>

<p>将 $f_{14}$ 与 $t$ 对应起来，绘在图上就可以了。</p>

<p>两个函数 $f_1, f_2$ 的表示，我们可以用 MATLAB 的符号计算功能，这样我们可以让我们的代码对所有的函数都适用而不需要计算各种向量，并且我们在实现换元、反折和平移的时候也很容易，只要使用 <code>subs()</code> 函数替换自变量即可。</p>

<p>至于符号计算的绘图，那当然是 <code>ezplot</code> 就解决啦……什么？<code>ezplot</code> 是不推荐的函数了？那就用 <code>fplot</code> 呗.</p>

<p>然后把每张图存起来，或者在画连续的两张图的时候有一个小小的时间间隔，就可以了做出动画的效果啦。</p>

<h1 id="实现">实现</h1>

<p>让我们首先定义一下我们要卷积的函数。假设我们有了两个函数 $f_1(t) = u(t) - u(t-2), f_2(t) = u(t-1) - u(t-3)$，要用图解法求 $f_1 * f_2$.</p>

<pre><code class="language-matlab">% 定义符号变量 t 和两个符号函数 f1, f2
% heaviside(t) 就是 u(t) 啦
syms t;
f1 = heaviside(t) - heaviside(t-2);
f2 = heaviside(t-1) - heaviside(t-3);

d = 0.05;           % 采样间隔
t1 = 0 : d : 2;     % f1 的卷积时域范围
t2 = 1 : d : 3;     % f2 的卷积时域范围
</code></pre>

<p>为了让我们写的东西具有普遍适用性，我们将它封装成一个如下的函数：</p>

<pre><code class="language-matlab">function [] = convolution_example(f1, f2, t1, t2, d)
</code></pre>

<p>函数的参数与上文定义的含义相同。具体函数实现如下：</p>

<pre><code class="language-matlab">function [] = convolution_example(f1, f2, t1, t2, d)
    syms t tao;         % 定义用于符号计算的变量
    figure;             % 在一个新的窗体上执行绘图
    grid on;
    hold on;            % 因为要多用多次 plot 和 fplot，所以要打开 hold
    
    % 以下计算，可参照连续信号的卷积函数
    time_start = t1(1) + t2(1);                              % 计算卷积结果序列非 0 值的起始位置
    time_length = length(t1) + length(t2) - 2;               % 计算卷积结果序列非 0 值得宽度
    
    f = time_start;                          % 时域起始位置 from
    e = time_start + time_length * d;        % 时域终止位置 end
    ymin = -5;
    ymax = 5;
    
    f11 = subs(f1, t, t - tao);             % 对 f1 进行换元、反折和位移：f1(t) =&gt; f1(tau) =&gt; f1(-tau) =&gt; f1(t-tau)
    fplot(f2, [f, e]);                      % f2 是固定的，可以先画到图上
    
    vec = f : d : e;                        % 生成卷积结果的时域向量
    p1 = fplot(f2, [f, e]);                 % 定义 p1 绘图句柄

    dt = [0];     ft = [0];
    
    % 循环绘图动画，对于卷积结果的时域向量中的每一个 t，都绘制一张该时刻的图
    for i = 1 : 1 : length(vec)
        f12 = subs(f11, {t tao}, {vec(i) t});   % 令 t0 = vec(i)，此时 f12 = f1(t0-tau)，即位移量为 t0
        f13 = f12 * f2;                         % 计算位移 t0 后的 f1 与 f2 的相乘结果

        delete(p1);                             % 先删除上一个 f12 的图像
        p1 = fplot(f12, [f e]);                 % 绘制新的 f12
        axis([f, e, ymin, ymax]);
        set(p1, 'Color', 'r');

        f14 = int(f13, f, e);                   % 计算积分值，即为在 t 时刻的 f1*f2 值

        % 为了使得绘出的图像平滑，将当前的 (t, f14) 添加到数组（向量）中，然后调用 plot 就可以绘出光滑的曲线
        % 否则，只调用 plot(t, f14) 只能绘出散点图

        % 并且，填充曲线下方到 x 轴的区域。根据简单的几何知识，因为间隔 d 足够小，所以只要填充一个梯形即可
        % 设当前的 t 值为 v(i)，当前函数值为 f(i)，那么只要填充梯形 (v(i), f(i)), (v(i), 0), (v(i-1), 0), (v(i-1), f(i-1)) 即可
        p2 = fill([dt(length(dt)), dt(length(dt)), vec(i), vec(i)], [0, ft(length(ft)), f14, 0], 'y');
        set(p2, 'LineStyle', 'none');
        dt = [dt vec(i)];
        ft = [ft f14];

        plot(dt, ft, '-b');                     % 最后绘制图形
        axis([f e ymin ymax]);
        
        pause(0.0001);                          % 短暂暂停，产生动画
    end
end
</code></pre>

<p>这里有几个小细节。第一是，如果循环的时候不将 $t$ 和 $f_{14}$ 都添加到一个向量中，而直接使用 plot 函数的话，会发生只能画散点图的情况，画出来的图像不连续：</p>

<p><img src="https://i.loli.net/2019/11/23/8bf52iUaoGvpHD7.png" alt="image.png" /></p>

<p>因此每次循环都将 $t$ 和 $f_{14}$ 加到已经计算过的向量 $dt$ 和 $ft$ 中，再次调用 plot 函数就能绘出光滑的直线/曲线：</p>

<p><img src="https://i.loli.net/2019/11/23/zlneq9kv8hDZdIC.png" alt="image.png" /></p>

<p>还有就是将卷积曲线下半部分填充的方式，MATLAB 可以用 <code>fill([x_coordinate], [y_coordinate], color)</code> 来填充一个多边形，根据简单的几何知识，我们只要填充一个小梯形即可：</p>

<p><img src="https://i.loli.net/2019/11/23/lfZGAk8XKpWDJz1.png" alt="image.png" /></p>

<p>OK，现在让我们拿两个任意函数来卷积一下，看看效果如何。不如我们令 $f_1(t) = \frac{1}{2}t[u(t)-u(t-2)], f_2(t) = (1-\frac{|t|}{2})[u(t+2)-u(t-2)]$ ，演示一下 $f_1 * f_2$ 吧：</p>

<pre><code class="language-matlab">syms t;
f1 = 1/2 * t * (heaviside(t) - heaviside(t - 2));
f2 = (1 - 1/2 * (abs(t))) * (heaviside(t + 2) - heaviside(t - 2));
d = 0.1;
t1 = 0 : d : 2;
t2 = -2 : d : 2;
convolution_example(f1, f2, t1, t2, d);
</code></pre>

<p>效果图：</p>

<p><img src="https://i.loli.net/2019/11/23/YdvVFJkIyiBtZNO.gif" alt="bandicam 2019-11-23 13-48-00-013.gif" /></p>

<p>对比一下我们用普通连续信号卷积函数计算出来的结果图：</p>

<p><img src="https://i.loli.net/2019/11/23/eBsYxE5vbMLtDka.png" alt="image.png" /></p>

<p>似乎挺不错。一个多小时的折腾似乎没白干。</p>

<p><s>那么问题来了，我为什么不直接去网上 Ctrl+C Ctrl+V 一份别人写好的呢？</s></p>

<p>别问，问就是吃饱撑着。</p>
      </div>
    </div>
  
<section class="section">
  <div class="container">
    <aside><div id="disqus_thread"></div></aside>
    <script type="text/javascript">
      var disqus_shortname = 'yume-diary';
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</section>


  </section>
  <section class="section footblock">
  <img src="https://secure.gravatar.com/avatar/c47187d311099868de825697fa419654?s=200&r=G" width="70px" height="70px" class="avatar">
  <div class="container has-text-centered">
    <p>&copy;2016-2019&nbsp;&nbsp;<a href='https://kirainmoe.com'>宇宙よりも遠い場所</a>  / Published with <a href="https://gohugo.io">Hugo</a> / <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh">CC-BY-SA 4.0</a> Licensed</p>
  </div>
</section>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js"></script>
<canvas id="live2d" width="300" height="300"></canvas>


<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/dockerfile.min.js"></script>
<canvas id="live2d" width="300" height="300"></canvas>


<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/matlab.min.js"></script>
<canvas id="live2d" width="300" height="300"></canvas>


<script>hljs.initHighlightingOnLoad();</script>
<script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script>
<script src="https://kirainmoe.com//index.js"></script>
<script type="text/javascript" src="https://kirainmoe.com//js/live2d.js"></script>
<script type="text/javascript">
  if (!window.mobilecheck())
  loadlive2d("live2d", "https:\/\/kirainmoe.com\//model/aya/model.json");
</script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-111347233-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</body>
