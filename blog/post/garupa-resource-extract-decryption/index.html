<body>
  <!DOCTYPE html>
<html lang="en-us">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta content="" name="keywords">
<meta content="バンドリ!ガールズバンドパーティ!（BanG Dream! 少女乐团派对）游戏资源/歌曲解包 - 宇宙よりも遠い場所" property="og:title">
<title>バンドリ!ガールズバンドパーティ!（BanG Dream! 少女乐团派对）游戏资源/歌曲解包 | 宇宙よりも遠い場所</title>
<script src="https://unpkg.com/muse-player/dist/assets/muse-player.js"></script>
<link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">
<link rel="stylesheet" href="https://kirainmoe.com//css/style.css">
<link rel="stylesheet" href="https://kirainmoe.com//css/custom.css">
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" integrity="sha384-9tPv11A+glH/on/wEu99NVwDPwkMQESOocs/ZGXPoIiLE8MU/qkqUcZ3zzL+6DuH" crossorigin="anonymous">
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none", 
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [["$", "$"], ["\\(", "\\)"]],
          displayMath: [["$$", "$$"], ["\\[", "\\]"]],
          skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"]
        },
        "HTML-CSS": {
          availableFonts: ["STIX", "TeX"], 
          showMathMenu: false
        }
	  });
</script>
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

<style type="text/css">
	.nav-left {	display: block; text-align: left; }
	.nav-link { display: inline-block; margin: 0px 20px 0px 0px;  }
	.nav-item { justify-content: flex-start;  }
	.nav-title { margin: 0px; font-size: 28px; font-weight: bold;  }
	.nav-title a { padding: 10px 0px;  }
	@media screen and (max-width: 700px) {
		.nav { display: block; text-align: center;  }
		.nav-title > .nav-item { display: block;  text-align: center; }
		.nav-left { text-align: center;  }
	}
</style>

  <section class="section navigator">
  <div class="navigator-background"></div>
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <h1 class="nav-title"><a class="nav-item" href="https://kirainmoe.com/">宇宙よりも遠い場所</a></h1>
        <div class="nav-links">
          <a class="nav-link" href="/pages/guestbook/">Guestbook</a>
          <a class="nav-link" href="/pages/friends/">Friends</a>        
          <a class="nav-link" href="https://about.me/kirainmoe">About</a>
        </div>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile">
          
          <a class="level-item" href="https://github.com/kirainmoe">
            <span class="icon">
              <i class="fa fa-github"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://weibo.com/returnnnn">
            <span class="icon">
              <i class="fa fa-weibo"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://acm.kirainmoe.com">
            <span class="icon">
              <i class="fa fa-tumblr"></i>
            </span>
          </a>
          
          <a class="level-item" href="/index.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>
          </a>
          
        </nav>
      </div>
    </nav>
  </div>
</section>

<div class="return-top">
  <i class="fa fa-angle-up"></i>
</div>

<div class="loading-progress"></div>
  <section class="section content-container">
    <div class="container article-here">
      <h2 class="subtitle is-6">June 15, 2019</h2>
      <h1 class="title">バンドリ!ガールズバンドパーティ!（BanG Dream! 少女乐团派对）游戏资源/歌曲解包</h1>
      
      <div class="tags">
    
        <a class="button is-link" href="/tags/games">games</a>
    
        <a class="button is-link" href="/tags/bang-dream">bang dream</a>
    
        <a class="button is-link" href="/tags/garupa">garupa</a>
    
</div>

      
      <div class="content">
        <p><img src="https://i.loli.net/2019/06/15/5d04f02dbd06449617.jpg" alt="" /></p>

<p>解包 《バンドリ!ガールズバンドパーティ!》（即 BanG Dream! 梦想协奏曲 少女乐团派对，以下简称 garupa）游戏的资源文件。</p>

<p>其实这不是什么新东西，网上已经有很多相关的教程了，只是因为整个过程有点繁琐，所以写一篇新的文章记录一下过程和补充一些细节。</p>

<p>下文以 Android 版本的日服和国服为例。以下内容仅供学习使用，请勿用于商业等用途。</p>

<h1 id="综述">综述</h1>

<p>Garupa 的主要资源文件（包括音乐、贴图、Live2D模型、语音、卡牌、BGM……）都存放在 /storage/emuated/0/Android/data/jp.co.craftegg.band/data/files 下（简体中文版的包名为：com.bilibili.star.bili），在这个文件夹下你可以看到一堆文件名为一串哈希值的无后缀文件，这些文件是压缩后的 Unity Asset Bundle 文件。</p>

<p>将这些压缩后的 bundle 文件展开，可以看到游戏的数据文件。其中有一些例如 Live2D 模型、表情、贴图、卡牌等文件以 mtn, 图片等形式存储，它们可以直接导出；而大部分的音乐（原创音乐、翻唱音乐、试听音乐、BGM等）通过加密、压缩之后，以 acb 的形式存储在 Unity Asset Bundle 中。</p>

<h1 id="所需工具">所需工具</h1>

<ul>
<li><a href="https://github.com/DerPopo/UABE">Unity Asset Bundle Extractor, UABE</a> 或 <a href="https://ci.appveyor.com/project/Perfare/assetstudio/branch/master/artifacts">AssetStudio (推荐)</a></li>
<li><a href="https://github.com/Rieksee/acbDecrypter/releases">acbDecrypter</a></li>
<li><a href="https://sourceforge.net/projects/vgmtoolbox/">vgmtoolbox</a></li>
<li><a href="https://github.com/Nyagamon/HCADecoder/releases">HCADecoder</a></li>
</ul>

<h1 id="第一步-获取-garupa-资源文件">第一步：获取 garupa 资源文件</h1>

<h2 id="方法-1">方法 1</h2>

<p>直接提取已下载好的数据包：<code>adb pull /storage/emulated/0/Android/data/jp.co.craftegg.band/data/files D:\bandori</code>；如果是国服： <code>adb pull /storage/emulated/0/Android/data/com.bilibili.star.bili/data/files D:\bandori</code>。</p>

<h2 id="方法-2">方法 2</h2>

<p>首先从 <a href="https://d2ktlshvcuasnf.cloudfront.net/Release/3.2.0.500/Android/AssetBundleInfo">https://d2ktlshvcuasnf.cloudfront.net/Release/3.2.0.500/Android/AssetBundleInfo</a> 获取日服的 AssetBundleInfo 的资源列表文件。其中，3.2.0.500 是游戏数据的版本，这个可以在 bangdream.ga 数据库里查到，左侧有一个 Japan Server Data Ver 就是当前日服的资源版本。</p>

<p>下载得到的 AssetBundleInfo 长这样：</p>

<p><img src="https://i.loli.net/2019/06/15/5d04defab7cf840552.jpg" alt="" /></p>

<p>根据左边的文件路径找到你所需要的资源。这里就需要有一些技巧，例如要下载 Pastel*Palettes 的歌曲《きゅ〜まい＊flower》，首先搜索 musicjacket（曲目封面）开头的内容，按照歌曲在游戏内上架时间和名称的关键字查找对应的 ID 项，如根据关键字和上架时间，定位到这首歌对应的是 <code>musicjacket/186_myflower</code>，说明这首歌的 ID 是 186，对应的资源文件是 <code>sound/bgm186</code>.</p>

<p>接下来下载，只需要将资源路径接到地址 <a href="https://d2ktlshvcuasnf.cloudfront.net/Release/3.2.0.500/Android/">https://d2ktlshvcuasnf.cloudfront.net/Release/3.2.0.500/Android/</a> 后面。例如要下载这首歌，资源文件的地址就是 <a href="https://d2ktlshvcuasnf.cloudfront.net/Release/3.2.0.500/Android/sound/bgm186">https://d2ktlshvcuasnf.cloudfront.net/Release/3.2.0.500/Android/sound/bgm186</a> .</p>

<p>两种方法得到的文件都是压缩过的 Unity Assets Bundle 文件。</p>

<h1 id="第二步-解压-unity-assets-bundle-文件">第二步：解压 Unity Assets Bundle 文件</h1>

<p>对于第一步中使用方法二下载的单文件，可以直接使用 UABE 或者 AssetStudio 打开。这里我们使用 AssetStudio 打开上面下载得到的文件，直接左上角 File-&gt;Load File 即可：</p>

<p><img src="https://i.loli.net/2019/06/15/5d04e34e7361783614.jpg" alt="" /></p>

<p>如果使用 UABE，打开之后会提示资源已压缩，让你选择解压出来保存的文件。随便选择一个位置保存，然后点击 Info 就可以看到这个文件的内容。</p>

<p><img src="https://i.loli.net/2019/06/15/5d04e5f8dbfa935222.jpg" alt="" /></p>

<p>打开后点击 Asset List 标签页。我们可以看到，这个 bundle 下有两个文件，其中我们感兴趣的是后缀为 .acb 的文件。这是一个 Unity 的 TextAsset 文件，实际上歌曲就以加密的形式存储在其中。我们将其右键选中，点击 &ldquo;Export selected assets&rdquo; 将其解压出来（如果是 UABE，选择右边的 Plugins/Export to .txt导出）。</p>

<hr />

<p>上面是打开单文件的情况。对于下载好的数据包，里面的资源文件都是乱码，我们无法知道哪个 bundle 文件里面包含了什么内容。此时可以使用 AssetStudio 批量读取，点击左上角 File-&gt;Load Folder 选择上面获得的数据包文件夹（D:\bandori）即可。</p>

<p>然后你可以在 Asset List 页面中看到所有的信息。在 Filter 中通过关键字筛选（如筛选所有的 acb 文件），然后点击 Export-&gt;Filtered Assets 可以导出筛选的资源。</p>

<p>导出后的文件可能是 .acb 后缀的文件，或者 .acb.txt 格式的文件（如果你是从 Export  菜单里导出）。后者其实本质上就是 .acb 文件，可以批量将其后缀改成 .acb：</p>

<pre><code class="language-batch">ren *.acb.txt *.acb
</code></pre>

<p>此外还有一些额外你可能会感兴趣的内容，例如游戏内的 Live BGM，bushimo/craftegg 语音， 抽卡 BGM 等等，它们位于 apk 安装包的 assets 下。</p>

<h1 id="第三步-解压-解密-acb-文件得到声音文件">第三步：解压、解密 acb 文件得到声音文件</h1>

<p>这一步我们有两种方案。第一种是直接使用 acbDecrypter，第二种方法是使用 vgmtoolbox 将 ACB 转换为 HCA，再使用 HCADecoder 将 HCA 解密。</p>

<h2 id="方法一-使用-acbdecrypter">方法一：使用 acbDecrypter</h2>

<p>首先解压 acbDecrypter，这里解压需要一些技巧：因为该程序的部分文件名是日文，如果直接解压可能会导致文件名乱码，影响程序的运行。为此我们需要先设置解压程序的编码，以 BandiZip 为例，在 选项-&gt;设置中，将“默认代码页”改为“日语”（弄完之后记得改回去嗷）：</p>

<p><img src="https://i.loli.net/2019/06/15/5d04e7de2ff0b64253.jpg" alt="" /></p>

<p>为了后面操作的方便，这里建议将解压后的目录添加到系统的 PATH 环境变量中，这一步就不多说了。</p>

<p>接下来将我们解包的 ACB 放到一个目录中（如放在 D:\test\bgm186.acb 下），在该路径下打开命令提示符，然后输入：</p>

<pre><code class="language-batch">chcp 932
</code></pre>

<p>这一步先修改 cmd 的编码为 932（日文 ShiftJIS）；然后输入：</p>

<pre><code class="language-batch">acbdecrypter
</code></pre>

<p>CMD 中会提示：“フォルダを選択？[y/N]”（选择文件夹？），我们输入 y 并选择当前文件夹；</p>

<p>接下来会提示 “HCAファイルが見つかりました。鍵を選択してください。”（已找到 HCA 文件，请选择解密使用的密钥），并弹出一个窗口让你选择游戏资源对应游戏的密钥：</p>

<p><img src="https://i.loli.net/2019/06/15/5d04e95fc6fac67629.jpg" alt="" /></p>

<p>WTF，弹出来的选择窗口除了几个带英文的都是乱码，根本不知道应该选哪个。此时我们找到 acbdecrypter 目录下的 hcaToWav 目录，在这里有一个 &ldquo;復号鍵リスト.txt&rdquo; 文件，里面存储的就是这个界面中列出密钥。我们使用 ShiftJIS 编码打开该文件，可以看到以下内容：</p>

<pre><code class="language-txt">CF222F1FE0748978 : デフォルト鍵
CC55463930DBE1AB : ファンタシースターオンライン2
0000000077EDF21C : ロウきゅーぶ！ ひみつのおとしもの
0000000049913556 : ロウきゅーぶ！ ないしょのシャッターチャンス
00000000012C9A53 : ジョジョの奇妙な冒険 オールスターバトル
00003657F27E3B22 : アイドルマスター シンデレラガールズ スターライトステージ
00003657F27E3B22 : シャドウバース ※未確認
0011DCDD0DC57F48 : グリモア～私立グリモワール魔法学園～
0000000000003039 : Fate/Grand Order (初期アセットのみ)
7E89631892EBF464 : Fate/Grand Order (ダウンロード完了後の音声データはこっち) ※未確認
FDAE531AAB414BA1 : Tokyo 7th シスターズ ※未確認
00000000001D149A : ONE PIECE DANCE BATTLE (ダンバト)
0000000000000978 : アイドルコネクト
00000000012EBCCA : ダービースタリオンマスターズ
0000000002B99F1A : ららマジ
00000000000022CE : バンドリ！ ガールズバンドパーティ！
</code></pre>

<p>可以看到这里给出了一些常见日游的解密密钥，我们想要的 《バンドリ！ ガールズバンドパーティ！》 密钥是 <code>00000000000022CE</code>，因此在上面的界面中，我们选择最后一项（其实这一步，将系统的非 Unicode 程序默认语言改成日语也可以正常显示，但是后面要恢复回去），并点击“决定”，此时程序就会自动开始解密：</p>

<p><img src="https://i.loli.net/2019/06/15/5d04ea92de35e79536.jpg" alt="" />
<img src="https://i.loli.net/2019/06/15/5d04ea92bf58b90570.jpg" alt="" /></p>

<p>当看到 &ldquo;全て完了しました。&rdquo;（全部完成了）的提示、并且没有报错的时候，表明资源已经成功解压。此时会自动打开一个后缀为 _decrypted 的文件夹，在里面会找到 .wav 格式的文件，这就是我们所需要的 wav 声音文件了：</p>

<p><img src="https://i.loli.net/2019/06/15/5d04eb10c22b815171.jpg" alt="" /></p>

<div id="muse-app"></div>

<h2 id="方法二-使用-vgmtoolbox-hcadecoder">方法二：使用 vgmtoolbox + HCADecoder</h2>

<p>首先打开 vgmtoolbox，依次展开左侧的 Misc.Tools -&gt; Extraction Tools -&gt; Common Archives -&gt; CRI ACB/AWB Archive Extractor，然后将 acb 文件拖进右边的空白处：</p>

<p><img src="https://i.loli.net/2019/06/15/5d04ebb4d24c730648.jpg" alt="" /></p>

<p>接下来在 acb 所在目录下会生成一个 <code>_vgmt_acb_ext_filename</code> 的文件夹，依次展开会得到一个 HCA 文件。</p>

<p>接下来解密这个 HCA 文件，将这个 hca 文件复制到 HCADecoder 的目录并在该目录下打开 cmd（或者直接将 HCADecoder 所在目录加入到 PATH 变量中，并在当前目录打开 cmd）。</p>

<p>这里我们先对 HCADecoder 这个脚本做一下修改，先将 &ldquo;オプション指定デコード.bat&rdquo; 改一个好调用一点的名字，例如 &ldquo;start.bat&rdquo;。然后使用 ShiftJIS 编码编辑该文件，在第 16 行左右的位置将 <code>set X_K=</code> 改为 <code>set X_K=00000000000022CE</code>，填入 garupa 的密钥（其它密钥可以在该目录下的 “復号鍵リスト.txt” 找到）。</p>

<p>然后我们直接运行：</p>

<pre><code class="language-batch">chcp 932
start.bat bgm186.hca
</code></pre>

<p><img src="https://i.loli.net/2019/06/15/5d04ed272f67614928.jpg" alt="" /></p>

<p>一路回车就可以得到 wav 文件。</p>

<h1 id="细节">细节</h1>

<h2 id="使用-assetstudio-提取的翻唱曲的解密">使用 AssetStudio 提取的翻唱曲的解密</h2>

<p>如果直接从已下载的数据包中提取 acb，会发现部分 acb 文件是分为多个 100K 文件存储的：</p>

<p><img src="https://i.loli.net/2019/06/15/5d04ee1e0cc8542127.jpg" alt="" /></p>

<p>对照<a href="http://chun37.hatenablog.com/entry/2018/01/01/071811">部分 ID 表</a>我们发现这些分文件存储的 acb 大部分都是翻唱曲。并且如果你使用 acbdecrypter 直接解密这个文件，会得到全损音质的 wav. 其实解密这些文件也很简单，只需要将文件从头到尾拼起来就好了，就是简单的循环+文件读取写入。以下是一个示例程序（为了展示它到底有多简单，这是一个 PHP 程序）：</p>

<pre><code class="language-php">&lt;?php
$content = '';
for ($i = 1; $i &lt;= 33; $i++) {          // '33' 是分文件的个数
    $filename = sprintf(&quot;Bgm008-%03d.acb&quot;, $i);
    $file = file_get_contents($filename);
    $content .= $file;
}
file_put_contents('bgm-008.acb', $content);
</code></pre>

<p>然后再使用第三步的方法解包就可以了。</p>

<h2 id="提取解密-acb-的密钥的方法">提取解密 ACB 的密钥的方法</h2>

<p>关于这个，在 HCADecoder 程序的仓库中有一个 &lsquo;復号鍵の探し方/メモ.txt` 的文件，作者在里面介绍了提取的一种方法。不过因为我太菜看不懂日语，所以如果各位有兴趣的话直接看该文件就可以。</p>

<h1 id="参考文章">参考文章</h1>

<ul>
<li><a href="http://refrigetwo.moe/2018/05/14/%E3%83%90%E3%83%B3%E3%83%89%E3%83%AA%EF%BC%81bang-dream%EF%BC%81%E5%B0%91%E5%A5%B3%E4%B9%90%E5%9B%A2%E6%B4%BE%E5%AF%B9-%E6%AD%8C%E6%9B%B2%E5%AF%BC%E5%87%BA/">バンドリ！BanG Dream！少女乐团派对 歌曲导出</a></li>
<li><a href="https://raspberrypi422.mydns.jp/wordpress/31/">バンドリ！ ファイル抽出/解析</a></li>
<li><a href="http://chun37.hatenablog.com/entry/2018/01/01/071811">ガルパ内部ID(曲)</a></li>
</ul>

<script>
var playlist = [{
    title: 'きゅ〜まい＊flower',
    artist: 'Pastel*Palettes',
    cover: '/assets/img/kyu-mai-flower.jpg',
    src: '/assets/mp3/kyu-mai-flower.mp3',
    lyric: '[offset:500]\n[00:21.24]応答せよ可愛さよ\n[00:23.83]か弱く揺れてるだけの\n[00:26.43]乙女心じゃないんだ常に\n[00:29.35](Go！ Go！ Go！ Go for it！)\n[00:31.75]目紛しい毎日に\n[00:34.26]振り落とされないように\n[00:36.90]努力努力で立ち向かう\n[00:39.32]強さに溢れてる\n[00:42.37]汗と涙 声にカスタマイズ(キラン)\n[00:47.55]秘密(秘密)ちょっと\n[00:49.57]あってもいいでしょ\n[00:52.55](ワン ツー スリー フォー)\n[00:53.88]cutie mighty floweryに\n[00:56.51]私を咲かせて(ポン×2)\n[00:59.12]とびきりの(ポン×2)輝き(ポン×2)\n[01:01.65]キミにあげるんだ(Love×4)\n[01:04.34]cutie mighty floweryに\n[01:06.99]女の子真っ盛りの\n[01:09.78](100点満開)笑顔で\n[01:12.10]今日も(ポン！)明日も(ポン！)\n[01:13.47]会いに行くから\n[01:25.27]パ！ス！パ！レ！満！開！(ポン×1+×1+×2)\n[01:30.21]ジャーン！\n'
}];
MUSE.render(playlist, document.getElementById('muse-app'));
</script>
      </div>
    </div>
  
<section class="section">
  <div class="container">
    <aside><div id="disqus_thread"></div></aside>
    <script type="text/javascript">
      var disqus_shortname = 'yume-diary';
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</section>


  </section>
  <section class="section footblock">
  <img src="https://secure.gravatar.com/avatar/c47187d311099868de825697fa419654?s=200&r=G" width="70px" height="70px" class="avatar">
  <div class="container has-text-centered">
    <p>&copy;2016-2019&nbsp;&nbsp;<a href='https://kirainmoe.com'>宇宙よりも遠い場所</a>  / Published with <a href="https://gohugo.io">Hugo</a> / <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh">CC-BY-SA 4.0</a> Licensed</p>
  </div>
</section>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js"></script>
<canvas id="live2d" width="300" height="300"></canvas>


<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/dockerfile.min.js"></script>
<canvas id="live2d" width="300" height="300"></canvas>


<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/matlab.min.js"></script>
<canvas id="live2d" width="300" height="300"></canvas>


<script>hljs.initHighlightingOnLoad();</script>
<script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script>
<script src="https://kirainmoe.com//index.js"></script>
<script type="text/javascript" src="https://kirainmoe.com//js/live2d.js"></script>
<script type="text/javascript">
  if (!window.mobilecheck())
  loadlive2d("live2d", "https:\/\/kirainmoe.com\//model/aya/model.json");
</script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-111347233-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</body>
