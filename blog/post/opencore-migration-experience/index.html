<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>
        OpenCore 引导迁移折腾记录 - 宇宙よりも遠い場所
      </title>
    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  
  <meta name="theme-color" content="#000000" />
  
  <meta http-equiv="window-target" content="_top" />
  
  
  <meta name="description" content=" 前言：OpenCore 引导（下文简称 OC）出来了很长一段时间了。但是最近不知什么原因，对新技术特别不敏感，所以观望了很久，也一直没有动手从 Clover 转 OpenCore. 嗯？那为什么会有这篇文章呢？这件事还要从一只蝙蝠说起……
" /><style>
    .marked-body h1 { border-bottom: 0px!important; }
  </style>



  
  <meta name="generator" content="Hugo 0.84.2 with theme pure" />
  <title>OpenCore 引导迁移折腾记录 - 宇宙よりも遠い場所</title>
  
  
  <link rel="stylesheet" href="https://kirainmoe.com/css/style.min.24c2ec8a0b80f65672b0654e875332dacecfbdbd27f17845d3a3cd9f3df8e252.css">
  
  <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/9.15.10/styles/github.min.css" async>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css" async>
  <meta property="og:title" content="OpenCore 引导迁移折腾记录" />
<meta property="og:description" content="
前言：OpenCore 引导（下文简称 OC）出来了很长一段时间了。但是最近不知什么原因，对新技术特别不敏感，所以观望了很久，也一直没有动手从 Clover 转 OpenCore. 嗯？那为什么会有这篇文章呢？这件事还要从一只蝙蝠说起……
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kirainmoe.com/blog/post/opencore-migration-experience/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2020-02-06T15:08:48&#43;08:00" />
<meta property="article:modified_time" content="2020-02-06T15:08:48&#43;08:00" />

<meta itemprop="name" content="OpenCore 引导迁移折腾记录">
<meta itemprop="description" content="
前言：OpenCore 引导（下文简称 OC）出来了很长一段时间了。但是最近不知什么原因，对新技术特别不敏感，所以观望了很久，也一直没有动手从 Clover 转 OpenCore. 嗯？那为什么会有这篇文章呢？这件事还要从一只蝙蝠说起……
"><meta itemprop="datePublished" content="2020-02-06T15:08:48&#43;08:00" />
<meta itemprop="dateModified" content="2020-02-06T15:08:48&#43;08:00" />
<meta itemprop="wordCount" content="7404">
<meta itemprop="keywords" content="opencore,hackintosh," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="OpenCore 引导迁移折腾记录"/>
<meta name="twitter:description" content="
前言：OpenCore 引导（下文简称 OC）出来了很长一段时间了。但是最近不知什么原因，对新技术特别不敏感，所以观望了很久，也一直没有动手从 Clover 转 OpenCore. 嗯？那为什么会有这篇文章呢？这件事还要从一只蝙蝠说起……
"/>

  <!--[if lte IE 9]>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
    <![endif]-->

  <!--[if lt IE 9]>
      <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
    <![endif]-->
    <script src="https://unpkg.com/muse-player/dist/assets/muse-player.js"></script>
</head>
  </head>

  
  

  <body class="main-center theme-white" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader">
    <div class="slimContent">
      <div class="navbar-header">
        <div class="profile-block text-center">
          <a id="avatar" href="https://kirainmoe.com" target="_blank">
            <img class="img-circle" src="https://kirainmoe.com/avatar.jpg" width="200" height="200">
          </a>
          <h2 id="name" class="hidden-xs hidden-sm">宇宙よりも遠い場所</h2>
          <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
          
        </div><div class="search" id="search-form-wrap">
    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i
                        class="icon icon-search"></i></button>
            </span>
        </div>
        <div class="ins-search">
            <div class="ins-search-mask"></div>
            <div class="ins-search-container">
                <div class="ins-input-wrapper">
                    <input type="text" class="ins-search-input" placeholder="Type something..."
                        x-webkit-speech />
                    <button type="button" class="close ins-close ins-selectable" data-dismiss="modal"
                        aria-label="Close"><span aria-hidden="true">×</span></button>
                </div>
                <div class="ins-section-wrapper">
                    <div class="ins-section-container"></div>
                </div>
            </div>
        </div>
    </form>
</div>
        <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
        <ul class="nav navbar-nav main-nav">
            <li class="menu-item menu-item-home">
                <a href="/">
                    <i class="icon icon-home-fill"></i>
                  <span class="menu-title">Home</span>
                </a>
            </li>
            <li class="menu-item menu-item-friends">
                <a href="/blog/post/friends/">
                    <i class="icon icon-link"></i>
                  <span class="menu-title">Friends</span>
                </a>
            </li>
            <li class="menu-item menu-item-guestbook">
                <a href="/blog/post/guestbook/">
                    <i class="icon icon-stackexchange"></i>
                  <span class="menu-title">Guestbook</span>
                </a>
            </li>
            <li class="menu-item menu-item-categories">
                <a href="/categories/">
                    <i class="icon icon-folder"></i>
                  <span class="menu-title">Categories</span>
                </a>
            </li>
            <li class="menu-item menu-item-tags">
                <a href="/tags/">
                    <i class="icon icon-tags"></i>
                  <span class="menu-title">Tags</span>
                </a>
            </li>
            <li class="menu-item menu-item-about">
                <a href="/blog/post/about/">
                    <i class="icon icon-cup-fill"></i>
                  <span class="menu-title">About</span>
                </a>
            </li>
        </ul>
      </nav>
    </div>
  </header>

<aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title"> Categories</h3>
    <div class="widget-body">
        <ul class="category-list">
            <li class="category-list-item"><a style="text-transform: uppercase;" href="https://kirainmoe.com/categories/acm/" class="category-list-link">acm</a><span class="category-list-count">14</span></li>
            <li class="category-list-item"><a style="text-transform: uppercase;" href="https://kirainmoe.com/categories/android/" class="category-list-link">android</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a style="text-transform: uppercase;" href="https://kirainmoe.com/categories/hackintosh/" class="category-list-link">hackintosh</a><span class="category-list-count">2</span></li>
            <li class="category-list-item"><a style="text-transform: uppercase;" href="https://kirainmoe.com/categories/icpc/" class="category-list-link">icpc</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a style="text-transform: uppercase;" href="https://kirainmoe.com/categories/linux/" class="category-list-link">linux</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a style="text-transform: uppercase;" href="https://kirainmoe.com/categories/react/" class="category-list-link">react</a><span class="category-list-count">7</span></li>
            <li class="category-list-item"><a style="text-transform: uppercase;" href="https://kirainmoe.com/categories/web/" class="category-list-link">web</a><span class="category-list-count">6</span></li>
            <li class="category-list-item"><a style="text-transform: uppercase;" href="https://kirainmoe.com/categories/%E5%85%B6%E5%AE%83/" class="category-list-link">其它</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a style="text-transform: uppercase;" href="https://kirainmoe.com/categories/%E5%89%8D%E7%AB%AF/" class="category-list-link">前端</a><span class="category-list-count">12</span></li>
            <li class="category-list-item"><a style="text-transform: uppercase;" href="https://kirainmoe.com/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="category-list-link">学习笔记</a><span class="category-list-count">4</span></li>
            <li class="category-list-item"><a style="text-transform: uppercase;" href="https://kirainmoe.com/categories/%E6%95%B0%E5%AD%A6/" class="category-list-link">数学</a><span class="category-list-count">3</span></li>
            <li class="category-list-item"><a style="text-transform: uppercase;" href="https://kirainmoe.com/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="category-list-link">数据结构</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a style="text-transform: uppercase;" href="https://kirainmoe.com/categories/%E6%97%A5%E8%AE%B0/" class="category-list-link">日记</a><span class="category-list-count">4</span></li>
            <li class="category-list-item"><a style="text-transform: uppercase;" href="https://kirainmoe.com/categories/%E6%B8%B8%E6%88%8F/" class="category-list-link">游戏</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a style="text-transform: uppercase;" href="https://kirainmoe.com/categories/%E7%A1%AC%E4%BB%B6/" class="category-list-link">硬件</a><span class="category-list-count">5</span></li>
            <li class="category-list-item"><a style="text-transform: uppercase;" href="https://kirainmoe.com/categories/%E7%AE%97%E6%B3%95/" class="category-list-link">算法</a><span class="category-list-count">16</span></li>
            <li class="category-list-item"><a style="text-transform: uppercase;" href="https://kirainmoe.com/categories/%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86/" class="category-list-link">自然语言处理</a><span class="category-list-count">1</span></li>
        </ul>
    </div>
</div>
      
<div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
        <ul class="recent-post-list list-unstyled no-thumbnail">
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://kirainmoe.com/blog/post/correct-way-to-type-react-hoc-with-ownprops-and-redux-connect/" class="title">React 带属性 &#43; Redux connect() 的高阶组件正确 Typing 方式</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2021-07-26 22:25:28 &#43;0800 CST" itemprop="datePublished">2021-07-26</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://kirainmoe.com/blog/post/2020-icpc-xiaomi-contest-qualification-round-1/" class="title">2020 ICPC Xiaomi (Qualification Round 1) - Part Solutions</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-10-26 22:57:15 &#43;0800 CST" itemprop="datePublished">2020-10-26</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://kirainmoe.com/blog/post/configure-multi-nic-on-linux-using-netplan/" class="title">Linux 下使用 netplan 配置多网卡</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-10-15 13:47:47 &#43;0800 CST" itemprop="datePublished">2020-10-15</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://kirainmoe.com/blog/post/deeplearning-ai-nlp-lesson-1/" class="title">【从零开始的 NLP】理论篇 L1. 分类和向量空间</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-07-12 00:58:58 &#43;0800 CST" itemprop="datePublished">2020-07-12</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://kirainmoe.com/blog/post/simplex-algorithm/" class="title">【学习笔记】线性规划的单纯形算法</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2020-02-11 18:35:07 &#43;0800 CST" itemprop="datePublished">2020-02-11</time>
                    </p>
                </div>
            </li>
        </ul>
    </div>
</div>
  </div>
</aside>

    
    
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <h4 class="toc-title">Catalogue</h4>
    <nav id="toc" class="js-toc toc">

    </nav>
  </div>
</aside>
<main class="main" role="main"><div class="content">
  <article id="-" class="article article-type-" itemscope
    itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      <h1 itemprop="name">
  <a
    class="article-title"
    href="/blog/post/opencore-migration-experience/"
    >OpenCore 引导迁移折腾记录</a
  >
</h1>

      <div class="article-meta">
        
<span class="article-date">
  <i class="icon icon-calendar-check"></i>&nbsp;
<a href="https://kirainmoe.com/blog/post/opencore-migration-experience/" class="article-date">
  <time datetime="2020-02-06 15:08:48 &#43;0800 CST" itemprop="datePublished">2020-02-06</time>
</a>
</span>
<span class="article-category">
  <i class="icon icon-folder"></i>&nbsp;
  <a class="article-category-link" href="/categories/%E7%A1%AC%E4%BB%B6/"> 硬件 </a>
  <a class="article-category-link" href="/categories/hackintosh/"> Hackintosh </a>
</span>  
  <span class="article-tag">
    <i class="icon icon-tags"></i>&nbsp;
    <a class="article-tag-link" href="/tags/opencore/"> opencore </a>
    <a class="article-tag-link" href="/tags/hackintosh/"> hackintosh </a>
  </span>

        <span class="post-comment"><i class="icon icon-comment"></i>&nbsp;<a href="/blog/post/opencore-migration-experience/#comments"
            class="article-comment-link">Comments</a></span>
		<span class="post-wordcount hidden-xs" itemprop="wordCount">Word Count: 7404words</span>
		<span class="post-readcount hidden-xs" itemprop="timeRequired">Read Count: 15minutes </span>
      </div>
    </div>
    <div class="article-entry marked-body js-toc-content" itemprop="articleBody">
      <blockquote>
<p>前言：OpenCore 引导（下文简称 OC）出来了很长一段时间了。但是最近不知什么原因，对新技术特别不敏感，所以观望了很久，也一直没有动手从 Clover 转 OpenCore. 嗯？那为什么会有这篇文章呢？<s>这件事还要从一只蝙蝠说起……</s></p>
</blockquote>

<blockquote>
<p>温馨提醒：此文章配置基于 OpenCore 0.5.5 版本；鉴于 OC 更新频繁，某些选项可能已经废弃或变更；请参照官方文档为准。</p>
</blockquote>

<h1 id="table-of-content">Table of Content</h1>

<p>这篇文章主要涵盖以下内容：</p>

<ol>
<li>OpenCore 引导配置的大体步骤和参考资料</li>
<li>从 Clover 迁移 OpenCore 的指南</li>
<li>使用 OpenCore 引导时的一些问题及解决方案</li>
<li>个人对 OpenCore 的理解</li>
</ol>

<h1 id="1-配置-opencore-引导">1. 配置 OpenCore 引导</h1>

<p>因为 OpenCore 的选项繁多，在配置 OpenCore 引导的时候，我们必须要了解大部分选项的功能/意图，就像我们在配置 Clover 的时候那样。只有明白这些选项的功能，当引导遇到问题的时候，才能大致地定位问题是由哪些选项引起的；即使不知道具体是哪个选项引起的，也很容易通过搜索引擎搜索关键词，从而快速地解决问题。</p>

<p>OpenCore 的 Release 中，提供了一份详尽解释 Config 中各项选项功能的 PDF 文档 《OpenCore Reference Manual》（位于 <code>Docs/Configuration.pdf</code> ）。另外，在该目录下还有每次版本更新的变动说明 （<code>Docs/Differences.pdf</code>）. 理论上来说，这些文档应该是配置 OC 时最好的参考依据，but，这么长的好几十页纸和满屏的英文，对于一些新手来说是一件很头疼的事情。</p>

<p>事实上，也有许多写的不错的中文的参考资料，例如 <a href="https://blog.xjn819.com/?p=543">xjn 的 《使用 OpenCore 引导黑苹果》</a> 和 <a href="https://blog.daliansky.net/OpenCore-BootLoader.html">黑果小兵 的 《精解 OpenCore》</a> 是我认为写得比较详尽的两篇。但是我个人非常推荐新手阅读 <a href="https://khronokernel-2.gitbook.io/opencore-vanilla-desktop-guide/">OpenCore Vanilla Guide</a> 里面的相关部分来配置 OpenCore 引导，虽然仍然是英文，但是里面的文章写得很清晰。</p>

<p>接下来我会以 CoffeeLake 平台的 OC 配置为例，结合 OpenCore Vanilla Guide 中的部分内容，讲解整个配置 OC 引导的过程。</p>

<h2 id="1-1-准备工作">1.1 准备工作</h2>

<p>我非常推荐大家在配置 OpenCore 的时候首先遵循最简和增量的原则，也就是：</p>

<ul>
<li>最简：尽可能地保持配置文件的简洁性，不要勾选没有用途的选项。这样的好处是减少一些因为勾选了部分选项导致的无法解释的行为，并且在排错的时候减少工作量。</li>
<li>增量：第一次配置 OC 时采用最小化的配置，当能够使用最小化配置正常引导 macOS 之后，再逐渐添加必要的 ACPI 补丁和内核拓展。这样的好处是一旦遇到异常情况，可以缩小问题的排查范围。</li>
</ul>

<p>为了从零开始配置一份 OC 引导，首先你需要下载这些东西。因为 OC 和关键部件更新速度很快，所以推荐下载最新版本。</p>

<ul>
<li>OpenCore 引导的核心工具包 OpenCorePkg：<a href="https://github.com/acidanthera/OpenCorePkg/releases">https://github.com/acidanthera/OpenCorePkg/releases</a></li>
<li>AppleSupportPkg：<a href="https://github.com/acidanthera/AppleSupportPkg/releases">https://github.com/acidanthera/AppleSupportPkg/releases</a></li>
<li>Lilu：<a href="https://github.com/acidanthera/Lilu/releases">https://github.com/acidanthera/Lilu/releases</a></li>
<li>VirtualSMC: <a href="https://github.com/acidanthera/VirtualSMC/releases">https://github.com/acidanthera/VirtualSMC/releases</a></li>
<li>WhateverGreen: <a href="https://github.com/acidanthera/WhateverGreen/releases">https://github.com/acidanthera/WhateverGreen/releases</a></li>
</ul>

<p>此外你还需要一个用于编辑 <code>config.plist</code> 的工具：尽可能地使用 <strong>Xcode</strong>，或 <a href="https://github.com/corpnewt/ProperTree">ProperTree</a>，这也是官方推荐的工具。但是随着时间推移，<strong>OpenCore Configurator</strong> 也逐渐完善了，所以现阶段也可以使用该工具来配置 OC，但必须确定你使用的 OpenCore Configurator 支持你所配置的 OC 版本。</p>

<h2 id="1-2-文件结构">1.2 文件结构</h2>

<ul>
<li>解压 OpenCorePkg，得到 <code>Docs, EFI 和 Utilities</code> 三个文件夹。我们接下来将以 <code>EFI</code> 文件夹为基础配置 OC.</li>
<li>从 Docs 文件夹中，复制 <code>Sample.plist</code> 到 <code>EFI/OC</code> 下并重命名为 <code>config.plist</code>. 该文件就是 OC 的配置文件。</li>
<li>从 <code>Docs/AcpiSamples</code>  文件夹中，使用 MaciASL 编译 <code>SSDT-AWAC.dsl</code>, <code>SSDT-EC-USBX.dsl</code>, <code>SSDT-PLUG.dsl</code>, <code>SSDT-PMC.dsl</code> 为相应的 <code>.aml</code> 文件，复制到 <code>EFI/OC/ACPI</code> 下，我会在后文解释这些 ACPI 补丁文件的作用。</li>
<li>解压 AppleSupportPkg，复制 <code>ApfsDriverLoader.efi</code> 和 <code>VBoxHFS.efi</code> 到 <code>EFI/OC/Drivers</code> 下。你也可以用从别处获得的 <code>HFSPlus.efi</code> 替换 <code>VBoxHFS.efi</code>.</li>
<li>解压 <code>Lilu, WhateverGreen, VirtualSMC</code>，复制相应的 <code>kext</code> 文件到 <code>EFI/OC/Kexts</code> 下。</li>
</ul>

<h2 id="1-3-修改-config-plist">1.3 修改 config.plist</h2>

<p>使用你喜欢的修改工具打开 <code>config.plist</code>，开始修改配置。</p>

<h3 id="1-3-1-修改-acpi-部分">1.3.1 修改 ACPI 部分</h3>

<p><img src="https://i.imgur.com/IkLFucw.png" alt="ACPI" /></p>

<p>我们主要关心 <code>ACPI=&gt;Add</code> 和 <code>ACPI=&gt;Patch</code> 两部分，前者是用来添加 <code>DSDT</code> 和 <code>SSDT</code> 补丁的地方，后者则是用来打 <code>ACPI</code> 重命名补丁的地方。</p>

<p>在 <code>ACPI=&gt;Add</code> 下，添加 <code>EFI/OC/ACPI</code> 文件夹中的所有编译好的 <code>DSDT</code> 和 <code>SSDT</code>，如前文复制过的 <code>SSDT-PLUG.aml</code> 等，记得将 <code>Enabled</code> 设置为 <code>YES</code>. 特别注意 OpenCore 的 DSDT/SSDT 加载是有顺序的，应该把 DSDT放在最前面；而 SSDT 如果没有特殊情况随意排序即可。</p>

<p>在 <code>ACPI=&gt;Patch</code> 下，主要是添加一些 ACPI 方法和设备的重命名。我们主要关心每一个 Patch 项的这些属性：</p>

<ul>
<li>Comment：注释，随你的心情填写</li>
<li>Find：原始 ACPI 中你要打补丁（改名）的部分，以十六进制的形式填写</li>
<li>Replace：如果在原始的 ACPI 中找到需要修改的地方，则将其替换为 Replace 中的内容；同样以十六进制填写</li>
<li>Count：这个重命名应该被应用几次，也就是有几个改名的部分被替换，如果不限制则填 0</li>
<li>Limit：最多应用次数的限制，如果不限制则填 0</li>
<li>Enabled: 是否应用此重命名</li>
</ul>

<p>打个比方，例如我们在映射键盘的 Fn 快捷键的时候，常常要把原来按快捷键调用的 ACPI 方法重命名，比如把 <code>_Q14</code> 改为 <code>XQ14</code> ，那么我们可以这样填写：</p>

<pre><code class="language-txt">Comment: change _Q14 to XQ14
Find: &lt;5F513134&gt;        // 注意，如果你使用 Xcode 编辑 Data 时必须就加上 &lt;&gt; 才可以，其它工具则不必要
Replace: &lt;58513134&gt;
Count: 0
Limit: 0
Enabled: YES
</code></pre>

<p>特别需要注意一件事情，OC 引导加载的 DSDT/SSDT 和这些 ACPI 补丁，是对<strong>所有通过 OC 引导的系统应用的</strong>；也就是说，如果你使用 OC 引导 Windows，那么 OC 同样会加载这些 SSDT 并应用这些重命名，这跟 Clover 是不一样的。因此 OC 官方推荐尽量不要有不必要的 ACPI 重命名；使用的 SSDT 中也要使用 <code>_OSI</code> 方法来判断是否为 macOS 按需加载。如果对此想更深入的了解，可以看看 <a href="http://bbs.pcbeta.com/forum.php?mod=viewthread&amp;tid=1830968">《关于 OpenCore 双系统引导的总结与讨论》</a> 这篇文章。</p>

<p>说起来，那么最开始让大家放进去的那几个 SSDT 有什么用途呢？</p>

<table>
<thead>
<tr>
<th>SSDT</th>
<th>用途</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>SSDT-AWAC.aml</code></td>
<td>修复 300 系列主板（B360, B365, H310, H370, Z390&hellip;）系列主板的 RTC 设备问题。例如说部分微星的主板，以及清华同方九代模具，都需要应用这个补丁，否则会卡住而无法进入系统，所以建议八代 (CoffeeLake) 以上的用户都添加这个 ACPI 补丁。</td>
</tr>

<tr>
<td><code>SSDT-EC-USBX.aml</code></td>
<td>这个 SSDT 同时添加了一个仿冒的 EC 设备并完善了 USB 的供电。当然，如果你的主板的 EmbeddedController 原生的 ACPI 命名就是 EC，则不需要该补丁。</td>
</tr>

<tr>
<td><code>SSDT-PMC.aml</code></td>
<td>这个 SSDT 与 NVRAM 相关。</td>
</tr>

<tr>
<td><code>SSDT-PLUG.aml</code></td>
<td>Skylake (6 代) 以上的机型，在 Clover 中可以直接勾选 “注入插件类型”，自动注入 <code>plugin-type=1</code> 参数，这是启用原生电源管理的关键。在 OC 中的替代方法就是加载此 SSDT.</td>
</tr>
</tbody>
</table>

<p>至于 <code>ACPI=&gt;Quirks</code> 里面的选项，则可以根据主板的情况按需选择，例如：</p>

<ul>
<li>如果你加载了自定义的 DSDT, 则 <code>RebaseRegions</code> 选项可以自动重新分配 ACPI 中的存储器域。</li>
<li>如果因为主板无法维护硬件签名导致重启，或睡眠唤醒时出现问题，则可以开启 <code>ResetHwSig</code> 选项。</li>
<li>如果使用 OC 引导 Windows 操作系统时不显示 OEM Logo，可以开启 <code>ResetLogoStatus</code>.</li>
<li>&hellip;</li>
</ul>

<h3 id="1-3-2-修改-booter-部分">1.3.2 修改 Booter 部分</h3>

<p><img src="https://i.imgur.com/suElruh.png" alt="booter" /></p>

<p>理论上来说，这一部分的选项不需要怎么修改。这里解释一下部分选项：</p>

<table>
<thead>
<tr>
<th>选项名</th>
<th>推荐</th>
<th>作用</th>
</tr>
</thead>

<tbody>
<tr>
<td>AvoidRuntimeDefrag</td>
<td>YES</td>
<td>修复一些与 UEFI 运行时有关的功能，例如时间、NVRAM、电源控制等</td>
</tr>

<tr>
<td>DevirtualiseMmio</td>
<td>YES</td>
<td>添加 <code>slide=N</code> 的选项，对于某些 300 系列主板是必须的</td>
</tr>

<tr>
<td>DisableSigleUser</td>
<td>NO</td>
<td>禁用通过 <code>-s</code> 或 <code>Cmd+S</code> 单用户模式，单用户模式类似 Windows 下带命令提示符的安全模式</td>
</tr>

<tr>
<td>DisableVaribleWrite</td>
<td>NO</td>
<td>本身是为不能支持原生 NVRAM 的主板设计，如果加入了 SSDT-PMC，则不需要勾选</td>
</tr>

<tr>
<td>EnableSafeModeSlide</td>
<td>YES</td>
<td>在安全模式下启用 <code>slide=N</code> 引导参数</td>
</tr>

<tr>
<td>EnableWriteUnprotector</td>
<td>YES</td>
<td></td>
</tr>

<tr>
<td>ProvideCustomSlide</td>
<td>YES</td>
<td>解决引导提示 <code>Only N/256 slide values are usable!</code> 的问题</td>
</tr>

<tr>
<td>SetupVirtualMap</td>
<td>YES</td>
<td></td>
</tr>

<tr>
<td>ShrinkMemoryMap</td>
<td>NO</td>
<td>除非内存映射空间很大，否则不需要选择此选项</td>
</tr>

<tr>
<td>SignalAppleOs</td>
<td>NO</td>
<td>欺骗硬件令其认为始终启动 macOS，不明白有什么意义，总之不选就是</td>
</tr>
</tbody>
</table>

<h3 id="1-3-3-修改-deviceproperties-部分">1.3.3 修改 DeviceProperties 部分</h3>

<p>这里可以为一些设备注入属性，例如为声卡设备注入 <code>layout-id</code> 使其通过 <code>AppleALC.kext</code> 驱动；或者为显卡注入 <code>ig-platform-id</code>，添加在 <code>DeviceProperties =&gt; Add</code> 下即可：</p>

<p><img src="https://i.imgur.com/kHKNvgl.png" alt="device-properties" /></p>

<p><code>DeviceProperties =&gt; Add</code> 下的每一个元素应该为一个 <code>Directory</code>，名称为设备的 <code>PCI</code> 路径：
- 例如声卡的设备路径一般是 <code>PciRoot(0x0)/Pci(0x1f,0x3)</code>
- 核显的设备路径一般是 <code>PciRoot(0x0)/Pci(0x2, 0x0)</code></p>

<p>声卡部分根据自己使用的声卡，参考 <a href="https://github.com/acidanthera/applealc/wiki/supported-codecs">Supported Codecs</a> 表格填写二进制值即可。例如，对于清华同方模具机型，一般采用 <code>Realtek ALC269vc</code> 声卡，注入 ID 为 29，则填写：</p>

<pre><code class="language-txt">Key: layout-id
Value: &lt;1D000000&gt;
Type: Data
</code></pre>

<p>显卡部分可以参考<a href="https://blog.daliansky.net/Intel-core-display-platformID-finishing.html">platform-id 速查表</a> 找到对应本机核显的平台和设备 ID，然后填写在对应的设备路径下。同时可能还需要设置一下 <code>framebuffer-stolenmem</code> 等值，以防止因为 <code>DVMT Pre-allocated</code> 值太小导致的 panic.</p>

<p>例如对于笔者的 8 代 CoffeeLake 笔记本平台的 <code>platform-id</code> 为 <code>3E9B0000</code>，则注入：</p>

<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Type</th>
</tr>
</thead>

<tbody>
<tr>
<td>AAPL,ig-platform-id</td>
<td>00009B3E</td>
<td>DATA</td>
</tr>

<tr>
<td>device-id</td>
<td>9B3E0000</td>
<td>DATA</td>
</tr>

<tr>
<td>framebuffer-patch-enable</td>
<td>01000000</td>
<td>DATA</td>
</tr>

<tr>
<td>framebuffer-stolenmem</td>
<td>00003001</td>
<td>DATA</td>
</tr>
</tbody>
</table>

<p>特别注意  <code>AAPL,ig-platform-id</code> 和 <code>device-id</code> 值的顺序是部分按字节反写的。</p>

<h3 id="1-3-4-修改-kernel-部分">1.3.4 修改 Kernel 部分</h3>

<p><img src="https://i.imgur.com/ACr6owo.png" alt="kernel" /></p>

<p>这部分主要是和内核相关的选项，也是 OC 配置中比较关键的地方。</p>

<p>首先让我们来看 <code>Kernel =&gt; Add</code> 部分，这里同时要说一下 OpenCore 与 Clover 的一个区别：Clover 引导时，如果没有特别被禁用掉的 Kext，那么会默认自动加载 <code>kexts</code> 文件夹下对应系统版本号和 <code>Other</code> 文件夹中的所有 kexts；而 <code>OpenCore</code> 并不会自动加在 <code>EFI/OC/Kexts</code> 下的内核拓展，而只会加载你写入 <code>config.plist</code> 中并启用的内核拓展，并且加载 Kexts 是有顺序区分的。我个人理解：这样做的好处是防止一些 可能冲突的 Kexts 因为加载顺序不同，导致出现无法预料的问题。</p>

<p>在 <code>Kernel =&gt; Add</code> 下要为你想加载的每一个内核拓展（及其子拓展）添加一个条目，条目包含以下属性：</p>

<table>
<thead>
<tr>
<th>属性名</th>
<th>解释</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>BundlePath</code></td>
<td>你想加载的内核拓展的路径。对于直接位于 <code>EFI/OC/Kexts</code> 下的 kext，直接填写名字即可，如 <code>Lilu.kext</code>；如果是某一个内核拓展的子拓展，则填写具体路径：如对于 <code>VoodooPS2Controller.kext</code> 的内核子拓展 <code>VoodooPS2Keyboard.kext</code>，则填写 <code>VoodooPS2Controller.kext/Contents/PlugIns/VoodooPS2Keyboard.kext</code></td>
</tr>

<tr>
<td><code>Comment</code></td>
<td>注释，随心情填写</td>
</tr>

<tr>
<td><code>ExecutablePath</code></td>
<td>可执行文件位置，对于有可执行文件的内核拓展，一般位于 <code>Contents/MacOS/[Kextname]</code>，如 <code>Lilu.kext</code> 的可执行文件位于 <code>Contents/MacOS/Lilu</code>；可以在访达中“查看包内容”来找到具体路径；如果没有则留空</td>
</tr>

<tr>
<td><code>PlistPath</code></td>
<td><code>Info.plist</code> 文件的位置，一般所有的 kext 都有此文件，位于 <code>Contents/Info.plist</code></td>
</tr>

<tr>
<td><code>MinKernel, MaxKernel</code></td>
<td>指定加载拓展的内核版本，一般留空即可，表示在所有的 macOS 版本下都加载</td>
</tr>

<tr>
<td><code>Enabled</code></td>
<td>是否加载该内核</td>
</tr>
</tbody>
</table>

<p>特别需要注意几个地方：</p>

<ul>
<li>第一是对于那些包含子 kext 的 kext，如 <code>VoodooPS2Controller.kext</code>, <code>VoodooI2C.kext</code>，需要将它们的子 kext（如 <code>VoodooI2CService.kext</code> 等）也一并写入。</li>
<li>内核拓展的加载是有顺序的，例如：建议把 <code>Lilu</code> 放在最前面，<code>VirtualSMC, AppleALC, WhateverGreen</code> 等依赖于 <code>Lilu</code> 的 kext 必须在 <code>Lilu</code> 加载之后加载；I2C 触摸板驱动的加载顺序应为：<code>VoodooI2Cservice.kext =&gt; VoodooGPIO.kext =&gt; VoodooI2C.kext =&gt; VoodooI2CHID.kext</code> 等。错误的加载顺序可能会导致系统 panic 或工作不正常。</li>
<li>OpenCore 没有 Clover 的 ForceKextsToLoad 功能，所以如果要强行加载系统 kext，必须将其复制到 <code>EFI/OC/Kexts</code> 下，并写在配置文件中加载。</li>
</ul>

<p><code>Kernel =&gt; Blocks</code> 用于禁止系统的 <code>Kext</code> 加载；<code>Kernel =&gt; Patch</code> 功能则对应的是 Clover 的  <code>KextsToPatch</code> 和 <code>KernelPatch</code> 两个功能，如有需要则可以按照在 Clover 中添加的方式，相同地添加在 OC 中。参数的作用与前文 ACPI 中阐述的一致。</p>

<p><code>Kernel =&gt; Emulate</code> 用于仿冒 CPU ID，如果你有不被 macOS 原生支持的 CPU （如奔腾，赛扬……），则可能需要用到这个功能。如果是较新的酷睿平台，这里可以留空。</p>

<p><code>Kernel =&gt; Quirks</code> 包含了部分常用的内核选项，这里翻译一部分：</p>

<table>
<thead>
<tr>
<th>属性名</th>
<th>推荐</th>
<th>作用</th>
<th>对应 Clover 选项</th>
</tr>
</thead>

<tbody>
<tr>
<td>AppleCpuPmCfgLock <br> AppleXcpmCfgLock</td>
<td>YES</td>
<td>对于那些没有解锁 CFG Lock 的设备，需要将这两项设置为 YES，否则会无法引导 macOS. 如果解锁了CFG Lock (MSR 0xE2)，无论是否勾选都不会有问题</td>
<td>KernelPM, KernelXCPM</td>
</tr>

<tr>
<td>AppleXcpmExtraMsrs</td>
<td>NO</td>
<td>对于某些奔腾和至强的 CPU 需要勾选以关闭多重 MSR 访问</td>
<td>-</td>
</tr>

<tr>
<td>AppleXcpmForceBoost</td>
<td>NO</td>
<td>强制最大倍频，一般用于至强 CPU</td>
<td>-</td>
</tr>

<tr>
<td>CustomSMBIOSGuid</td>
<td>NO</td>
<td>一般与戴尔笔记本相关</td>
<td>DellSMBIOSPatch</td>
</tr>

<tr>
<td>DisableIOMapper</td>
<td>YES</td>
<td>开启此选项以便解决与 Intel VT-d 的冲突</td>
<td>-</td>
</tr>

<tr>
<td>DummyPowerManagement</td>
<td>NO</td>
<td>禁用原生电源管理，可以替代 <code>NullCPUPowerManagement.kext</code>，对于农企家的 CPU 需要勾选，牙膏厂家的则不需要</td>
<td>-</td>
</tr>

<tr>
<td>ExternalDiskIcons</td>
<td>YES</td>
<td>如果内置的 NVME 设备被识别为外置存储，则勾选此选项</td>
<td>-</td>
</tr>

<tr>
<td>LapicKernelPanic</td>
<td>NO</td>
<td>一般用于惠普的笔记本无法启动时</td>
<td>KernelLapic</td>
</tr>

<tr>
<td>PanicNoKextDump</td>
<td>YES</td>
<td>指定当系统发生 panic 时，是否显示已加载的 kext 列表。这里建议设为 YES 以便后期 panic 时排错</td>
<td>PanicNoKextDump</td>
</tr>

<tr>
<td>PowerTimeoutKernelPanic</td>
<td>YES</td>
<td></td>
<td></td>
</tr>

<tr>
<td>ThirdPartyDrives</td>
<td>NO</td>
<td>为 SATA SSD 打开 Trim</td>
<td></td>
</tr>

<tr>
<td>XhciPortLimit</td>
<td>NO</td>
<td>破解 USB 15 端口限制，官方建议定制 USB 替代</td>
<td></td>
</tr>
</tbody>
</table>

<h3 id="1-3-5-修改-misc-部分">1.3.5 修改 Misc 部分</h3>

<p><img src="https://i.imgur.com/OROZbCk.png" alt="misc" /></p>

<p>这一部分与 OpenCore 的引导行为有关，官方的建议是：</p>

<blockquote>
<p>leave as-is unless you know what you&rsquo;re doing. (除非你知道自己在做什么，否则保持默认值即可)</p>
</blockquote>

<p>这里给出部分推荐设置和解释：</p>

<table>
<thead>
<tr>
<th>属性</th>
<th>推荐值</th>
<th>解释</th>
</tr>
</thead>

<tbody>
<tr>
<td>Console Mode</td>
<td>Max</td>
<td>设置控制台模式为最大允许分辨率</td>
</tr>

<tr>
<td>Console Behaviors Os</td>
<td>Graphics</td>
<td>-</td>
</tr>

<tr>
<td>Console Behaviors Ui</td>
<td>Text</td>
<td>-</td>
</tr>

<tr>
<td>Resolution</td>
<td>屏幕的最大分辨率</td>
<td>-</td>
</tr>

<tr>
<td>Timeout</td>
<td>按你的喜好设置</td>
<td>引导默认系统的超时</td>
</tr>

<tr>
<td>Hibernate Mode</td>
<td>Node</td>
<td>黑苹果不要开休眠到硬盘的模式 (Hibernate)</td>
</tr>

<tr>
<td>Hide Self</td>
<td>YES</td>
<td>在 Picker 中隐藏 OC 启动项</td>
</tr>

<tr>
<td>Show Picker <br> Use Picker</td>
<td>YES</td>
<td>是否使用操作系统选择器</td>
</tr>

<tr>
<td>PollAppleHotKeys</td>
<td>YES</td>
<td>是否允许使用热键，如 <code>Cmd+V</code> 进入啰嗦模式</td>
</tr>

<tr>
<td>DisableWatchDog</td>
<td>YES</td>
<td>官方说解决一些 OC 无法正常引导的问题</td>
</tr>

<tr>
<td>AllowNvramReset</td>
<td>YES</td>
<td>允许清空 NVRAM，<strong>注意在一些机型上该选项会同时清空 UEFI 启动项数据</strong></td>
</tr>

<tr>
<td>AllowSetDefault</td>
<td>YES</td>
<td>允许使用 Ctrl+Enter 设置默认引导系统</td>
</tr>

<tr>
<td>RequireSignature <br> RequireVault</td>
<td>NO</td>
<td>因为不使用 FileVault 加密（或文件保险箱），所以不选择</td>
</tr>

<tr>
<td>ScanPolicy</td>
<td>0</td>
<td>使 OpenCore 扫描所有分区上的操作系统</td>
</tr>
</tbody>
</table>

<p>上面未提到的值保持默认即可。</p>

<h3 id="1-3-6-修改-nvram-部分">1.3.6 修改 NVRAM 部分</h3>

<p><img src="https://i.imgur.com/HM4FTH6.png" alt="nvram" /></p>

<p>默认 NVRAM 部分有两个分类:</p>

<p><code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14</code> 中有一个选项 <code>UIScale</code>，如果没有特殊情况大部分电脑填写 <code>01</code> 即可。</p>

<p><code>7C436110-AB2A-4BBB-A880-FE41995C9F82</code> 下：</p>

<ul>
<li><code>boot-args</code> 即引导参数，根据需要填写就好，推荐在调试的时候保留 <code>-v keepsyms=1 debug=0x100</code> 这三个参数。部分主板可能需要填写 <code>slide</code> 值，具体与用 Clover 引导时的规则一致。</li>
<li><code>csr-active-config</code> 即系统完整性保护 (SIP) 的状态:</li>
</ul>

<table>
<thead>
<tr>
<th>value</th>
<th>解释</th>
</tr>
</thead>

<tbody>
<tr>
<td>00000000</td>
<td>完全开启 SIP</td>
</tr>

<tr>
<td>30000000</td>
<td>允许未签名的 Kext 加载</td>
</tr>

<tr>
<td>E7030000</td>
<td>完全关闭 SIP</td>
</tr>
</tbody>
</table>

<ul>
<li><code>prev-lang:kbd</code> 即默认语言和键盘布局，中国大陆用户可以填写 <code>7A682D48 616E733A 323532</code>.</li>
<li><code>nvda_drv</code> 即是否加载 N 卡驱动，仅限 10.13.6 以下系统，填写 <code>31</code> 即为加载；如果不加载则可以删除该项。</li>
</ul>

<p>其它的选项我们都可以保留默认，不用修改。</p>

<h3 id="1-3-7-修改-platforminfo-部分">1.3.7 修改 PlatformInfo 部分</h3>

<p><img src="https://i.imgur.com/JpLxh35.png" alt="smbios" /></p>

<p>这一部分即为 SMBIOS 信息，填写 <code>Generic</code> 中的内容即可，<code>SpoofVendor</code> 设为 <code>Yes</code>，然后填写序列号 (<code>SystemSerialNumber</code>)、主板序列号 (<code>MLB</code>)、SmUUID (<code>SystemUUID</code>) 和 ROM 等；可以使用 Clover Configurator 或 macserial 等程序生成。<code>SystemProductName</code> 要填写与序列号和主板号对应的型号。</p>

<p>如笔者在 <code>SystemProductName</code> 填写 <code>MacbookPro15,3</code>，表示仿冒 SMBIOS 机型为 MacBook Pro (15inch, 2019), 对应序列号应为 <code>C02xxxxxLVCG</code>.</p>

<h3 id="1-3-8-修改-uefi-部分">1.3.8 修改 UEFI 部分</h3>

<p><img src="https://i.imgur.com/l1ayKSf.png" alt="uefi" /></p>

<p>这一部分主要和 OC 引导系统的行为有关，同时也是 OC 区别于 Clover 引导的行为体现最多的一个部分。</p>

<p>首先设置 <code>ConnectDrivers</code> 为 <code>YES</code>, 接下来我们仍然只修改一些必要的部分。</p>

<p>在 <code>Drivers</code> 中，添加 <code>EFI/OC/Drivers</code> 中你希望加载的 efi 驱动。注意这个加载驱动的列表仍然是有序的，一般我们需要：</p>

<ul>
<li>ApfsDriverLoader.efi ： 苹果的 APFS 格式文件系统驱动，引导 macOS 必须驱动</li>
<li>VBoxHFS.efi ： 苹果的 HFS+ 格式文件系统驱动，也可以用 HFSPlus.efi 替代</li>
<li>FwRuntimeService.efi ：集成 NVRAM 模拟和 AptioMemoryFix 驱动，必须</li>
</ul>

<p>其它的则可以根据需要自行添加，如加入 <code>AppleUsbKbDxe.efi</code> 以支持快捷键、加入 <code>VirtualSMC.efi</code> 和 <code>VirtualSMC.kext</code> 配合等。当然，前提是要保证你的 <code>EFI/OC/Drivers</code> 下有这些驱动。</p>

<p><code>Input</code> 中，基本保持默认即可。可以设置 <code>KeySupport = YES</code> 以开启原生快捷键支持。一般我们不需要修改 <code>Protocols</code> 中的内容，保持默认即可。</p>

<p><code>Quirks</code> 部分就比较复杂，这里给出部分选项的推荐值和解释，其它的保持默认即可。</p>

<table>
<thead>
<tr>
<th>属性名</th>
<th>推荐</th>
<th>解释</th>
</tr>
</thead>

<tbody>
<tr>
<td>ReleaseUsbOwnership</td>
<td>NO</td>
<td>释放 USB 控制器驱动，等同于 Clover 中的 FixUSBOwnership</td>
</tr>

<tr>
<td>RequestBootVarFallback <br> RequestBootVarRouting</td>
<td>YES</td>
<td>OC 要求开启这两个选项</td>
</tr>

<tr>
<td>SanitiseClearScreen</td>
<td>YES</td>
<td>修复高分屏以 1024x768 的分辨率显示 OC，但是有时候也会有反效果</td>
</tr>

<tr>
<td>ProvideConsoleGOP</td>
<td>YES</td>
<td>解决选择引导后黑屏</td>
</tr>
</tbody>
</table>

<p>到这里，终于完成了 OC 的配置，果然如同传言的一般繁琐。接下来就可以把 EFI 文件夹拷贝到 U 盘的 ESP 分区里，尝试启动了。注意的是，不同于 Clover，OC 必须引导 <code>EFI/Boot/bootx64.efi</code> 启动，而不能引导 <code>EFI/OC/OpenCore.efi</code> 启动，否则无效。</p>

<h1 id="2-从-clover-迁移-opencore-的指南">2.从 Clover 迁移 OpenCore 的指南</h1>

<p>很多人可能正在使用 Clover 启动，如果要从 Clover 转到 OC 引导的话，可能会遇到一些问题。这里就根据我个人转换引导的经验，写一份指南。</p>

<h2 id="2-1-dsdt-ssdt-的改动">2.1 DSDT/SSDT 的改动</h2>

<p>因为 Clover 引导 Windows 的时候并不会加载 SSDT 补丁和 ACPI 重命名的，但是 OC 会这样做，所以一般需要对 SSDT 补丁进行一些改动，以便使其只应用于 macOS 下，具体可以参考上文提到的文章。基于此原因，还需要删除不必要的 ACPI 重命名。</p>

<p>需要注意的是，如果仍然保留原先 Clover 下的 SSDT 和 DSDT 以及 ACPI 命名，是仍然可以正常引导 macOS 的。</p>

<h2 id="2-2-部分-acpi-补丁的替代">2.2 部分 ACPI 补丁的替代</h2>

<p>在使用 Clover 的时候，Clover 强大的 ACPI 功能可以帮我们自动打了一些补丁，比如在 <code>ACPI</code> 中勾选 “修复 HPET (Fix HPET)”、“修复 IPIC (Fix IPIC)” 等，同时还有注入插件类型的功能。然而这些功能 OpenCore 并不原生支持，我们需要添加并加载一些 SSDT 才可以实现。</p>

<p>对于插件类型，也即 <code>plugin-type=1</code>，在上文中我们已经提到了，可以通过加载 <code>SSDT-PLUG.aml</code> 来解决。</p>

<p>对于 <code>HPET</code> 和 <code>IRQ</code> 相关的补丁，可以使用 <a href="https://khronokernel.github.io/Getting-Started-With-ACPI/ssdt-easy.html">SSDTTime</a> 根据原始 DSDT 自动生成。</p>

<p>对于 <code>PNLF</code>，在 <code>WhateverGreen</code> 的 Release 中提供了 <code>SSDT-PNLF.aml</code>，加载该文件即可。</p>

<p>其它选项的替代方案，可以参考：<a href="https://github.com/khronokernel/Opencore-Vanilla-Desktop-Guide/blob/master/clover-conversion/Clover-config.md">https://github.com/khronokernel/Opencore-Vanilla-Desktop-Guide/blob/master/clover-conversion/Clover-config.md</a></p>

<h2 id="2-3-引导相关设置">2.3 引导相关设置</h2>

<p>引导参数 (Boot Args)：对应 OpenCore NVRAM 部分的 <code>7C436110-AB2A-4BBB-A880-FE41995C9F82 -&gt; boot-args</code>.</p>

<h2 id="2-4-设备相关设置">2.4 设备相关设置</h2>

<p>Clover 提供的大部分设备属性，可以通过对相应设备注入 DeviceProperties 实现，参照<a href="https://github.com/khronokernel/Opencore-Vanilla-Desktop-Guide/blob/master/clover-conversion/Clover-config.md#devices">此对照表</a>。只有对于 IGPU 的 <code>FakeID</code> 处理方式稍有不同，可以参考<a href="https://github.com/khronokernel/Opencore-Vanilla-Desktop-Guide/blob/master/clover-conversion/FakeID-conversion.md">这篇指南</a>。</p>

<h2 id="2-5-内核补丁相关设置">2.5 内核补丁相关设置</h2>

<p>参考上文 “1.3.4 修改 Kernel 部分”，你能找到与 Clover 对应的选项。</p>

<h1 id="3-使用-opencore-引导时的一些问题及解决方案">3. 使用 OpenCore 引导时的一些问题及解决方案</h1>

<p>事实上，OC 引导现在远远没有达到很成熟的地步，因此初次使用 OpenCore 引导必然会出现这样和那样的问题。尤其是对于 Clover 转 OpenCore 的用户，更是难以理解：为什么同样的配置方法在 Clover 下可用，但是到 OC 下根本无法引导。这里就笔者遇到的一些问题，写出解决方案，供如果有遇到同样问题的人参考。</p>

<p>当然，在遇到问题的时候，Google 和百度永远是你的好伙伴。此外也可以多去 pcbeta 和 tonymacx86 等网站爬帖。OpenCore Vanilla Guide 中的以下文章也是很好的参考：<a href="https://khronokernel-2.gitbook.io/opencore-vanilla-desktop-guide/troubleshooting/troubleshooting">General Troubleshooting</a> .</p>

<h3 id="引导-opencore-后回到-bios-引导选择界面">引导 OpenCore 后回到 BIOS / 引导选择界面</h3>

<p>首先要确定你的 ESP 分区内分区结构正确，然后确保你引导的是 <code>EFI/BOOT/bootx64.efi</code> 而不是 <code>EFI/OC/OpenCore.efi</code>，如上文所提到的。</p>

<h3 id="引导时提示-no-vault-provided">引导时提示 <code>no vault provided!</code></h3>

<p>关闭 <code>Misc -&gt; Security</code> 中的 <code>RequireSignature</code> 和 <code>RequireVault</code>，关闭 FileVault.</p>

<h3 id="引导系统时卡在-pci-configuration-begins-previous-shutdown-hid-legacy-apfs-module-start-等">引导系统时卡在 PCI Configuration Begins, Previous Shutdown&hellip;, HID: Legacy&hellip; apfs_module_start&hellip; 等</h3>

<p>确认你打了 <code>SSDT-EC.aml</code> 或 <code>SSDT-EC-USBX.aml</code> 补丁和 <code>SSDT-AWAC.aml</code> 补丁。</p>

<p>如果无效，尝试添加 <code>npci=0x2000</code> 参数。</p>

<p>如果仍然无效，关闭 <code>UEFI =&gt; Quirks =&gt; ReleaseUsbOwnership</code> 选项。</p>

<h3 id="出现禁行标志并提示-still-waiting-for-root-devices">出现禁行标志并提示 <code>still waiting for root devices</code></h3>

<p>首先确定你在 BIOS 中将 SATA 模式设置为 AHCI 而不是 RAID 等。</p>

<p>如果确实是 AHCI，则尝试打开 <code>Kernel =&gt; Quirks =&gt; XhciPortLimit</code>。</p>

<p>如果还是没有解决，尝试打开 <code>UEFI =&gt; Quirks =&gt; ReleaseUsbOwnership</code> 选项。</p>

<p>如果以上无法解决，考虑定制 USB.</p>

<h3 id="kernel-panic-并提示-cannot-perform-kext-summary">Kernel Panic 并提示 &ldquo;Cannot perform kext summary&rdquo;</h3>

<p>多半是由于 kext 的加载顺序错误，建议按上文所建议的顺序加载。</p>

<h3 id="因为-appleintel-framebuffer-导致的-kernel-panic">因为 <code>AppleIntel***Framebuffer</code> 导致的 Kernel Panic</h3>

<p>首先出现这种问题多半是因为 DVMT Pre-allocated 的问题，先进入系统尝试使用 Hackintool 打缓冲帧补丁，并合并到 OC 的 DeviceProperties 中。</p>

<p>但是我在迁移的过程中，发现与 Clover 中同样的属性值和补丁，在 OC 中却导致了这样的错误。最终发现原因是因为没有加载 <code>SSDT-PLUG.aml</code>，即没有注入 <code>plugin-type=1</code>.</p>

<h3 id="i2c-触摸板不可用-但驱动已经加载">I2C 触摸板不可用，但驱动已经加载</h3>

<p>强制 <code>IOGraphicsFamily.kext</code> 加载即可。由于 OC 没有 ForceKextsToLoad 的功能，我们需要从 macOS 的 <code>/System/Library/Extendsion</code> 下提取这个 kext 放到 <code>EFI/OC/Kexts</code> 下，并在 config.plist 的 <code>Kernel =&gt; Add</code> 中添加此 Kext.</p>

<h1 id="4-个人对-opencore-的看法和总结">4. 个人对 OpenCore 的看法和总结</h1>

<p>到此，这篇文章就要结束了。断断续续地折腾了好久的 OC 引导，对此有一些个人的看法。</p>

<p>首先，OpenCore 是不是未来的潮流，答案是肯定的，因为现在 Hackintosh 社区的重心已经放在了 OC 的开发上，并且许多 kext 的测试已经转到了 OC 上。</p>

<p>但是， OC 一定比 Clover 更优秀吗？至少现阶段我对这个问题并不持肯定的态度。原因有二，第一是虽然 OC 在引导方面的功能很强大，但 OC 的配置十分繁琐，并不一定适合所有的用户。第二是虽然 OC 有很多 Clover 没有的新特性，但是在一些机型的兼容性方面反而不如 Clover. 再有，因为 OC 的引导机制与 Clover 的巨大不同，OC 对多系统引导的支持反而不如 Clover.</p>

<p>所以现阶段我的看法是，对于那些喜欢折腾、有能力解决问题的人，那么可以尝试一下 OpenCore，以便在未来能够无缝过渡；但是对于一般用户，或者追求稳定的用户，则完全没有必要这么着急跟风上 OpenCore.</p>

<p>以上。</p>
    </div>
    <div class="article-footer">
<blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    <li class="post-copyright-link hidden-xs">
      <strong>文章链接：</strong>
      <a href="https://kirainmoe.com/blog/post/opencore-migration-experience/" title="OpenCore 引导迁移折腾记录" target="_blank" rel="external">https://kirainmoe.com/blog/post/opencore-migration-experience/</a>
    </li>
    <li class="post-copyright-license">
      <strong>许可协议：</strong><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="external">CC-BY-NC-SA 4.0 国际</a>
    </li>
  </ul>
</blockquote>

<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://kirainmoe.com" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="https://kirainmoe.com/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://kirainmoe.com" target="_blank"><span class="text-dark">Yume Maruyama</span><small class="ml-1x"></small></a></h3>
        <div>まんまるお山に彩りを✨~</div>
      </div>
    </figure>
  </div>
</div>
    </div>
  </article>
<section id="comments">
    <div id="vcomments"></div>
</section>

</div><nav class="bar bar-footer clearfix" data-stick-bottom>
    <div class="bar-inner">
        <ul class="pager pull-left">
            <li class="prev">
                <a href="https://kirainmoe.com/blog/post/past-present-future-2019-annual-review/" title="过去·现在·未来——2019 年度回顾"><i
                        class="icon icon-angle-left"
                        aria-hidden="true"></i><span>&nbsp;&nbsp;Older</span></a>
            </li>
            <li class="next">
                <a href="https://kirainmoe.com/blog/post/simplex-algorithm/"
                    title="【学习笔记】线性规划的单纯形算法"><span>Newer&nbsp;&nbsp;</span><i
                        class="icon icon-angle-right" aria-hidden="true"></i></a>
            </li>
            
            <li class="toggle-toc">
                <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false"
                    title="Catalogue" role="button">
                    <span>[&nbsp;</span><span>Catalogue</span>
                    <i class="text-collapsed icon icon-anchor"></i>
                    <i class="text-in icon icon-close"></i>
                    <span>]</span>
                </a>
            </li>
        </ul>
        <div class="bar-right">
        </div>
    </div>
</nav>

</main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
<ul class="social-links">
    <li><a href="https://github.com/kirainmoe" target="_blank" title="github" data-toggle=tooltip data-placement=top >
            <i class="icon icon-github"></i></a></li>
    <li><a href="https://kirainmoe.com/index.xml" target="_blank" title="rss" data-toggle=tooltip data-placement=top >
            <i class="icon icon-rss"></i></a></li>
    <li><a href="http://weibo.com/returnnn" target="_blank" title="weibo" data-toggle=tooltip data-placement=top >
            <i class="icon icon-weibo"></i></a></li>
</ul>
  <div class="copyright">
    &copy;2016  -
    2021
    宇宙よりも遠い場所
    <div class="publishby">
        Theme <a href="https://github.com/xiaoheiAh/hugo-theme-pure" target="_blank"> Pure</a> by <a href="https://github.com/xiaoheiAh" target="_blank"> xiaoheiAh </a>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script>
    window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/highlight.min.js"></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/python.min.js" defer></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/javascript.min.js" defer></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/cpp.min.js" defer></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/java.min.js" defer></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/typescript.min.js" defer></script><script>
    hljs.configure({
        tabReplace: '    ', 
        classPrefix: ''     
        
    })
    hljs.initHighlightingOnLoad();
</script>
<script src="https://kirainmoe.com/js/application.min.a94ab19cb63a95c8d7fbd7b85cab3ddeea8c369bdf75b9cab6708787ead123af.js"></script>
<script src="https://kirainmoe.com/js/plugin.min.19c5bcb2fb0789ab4f2b7834e5ceb5e92635645605bab902c1024b25f1502364.js"></script>

<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            ROOT_URL: 'https:\/\/kirainmoe.com\/',
            CONTENT_URL: 'https:\/\/kirainmoe.com\/\/searchindex.json ',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script type="text/javascript" src="https://kirainmoe.com/js/insight.min.4a2d52de4bfff73e0c688404fe3d17c9a3ae12d9888e1e1ac9c690e4890de2ded50fe55f2b819c2ba55435a76f396f3ea6805765f0b0af5635cdf74ea459eab0.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
<script>
    tocbot.init({
        
        tocSelector: '.js-toc',
        
        contentSelector: '.js-toc-content',
        
        headingSelector: 'h1, h2, h3',
        
        hasInnerContainers: true,
    });
</script>

<script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/valine"></script>
<script type="text/javascript">
    var GUEST = ['nick', 'mail', 'link'];
    var meta = 'nick,mail';
    meta = meta.split(',').filter(function (item) {
        return GUEST.indexOf(item) > -1;
    });
    new Valine({
        el: '#vcomments',
        verify: true ,
        notify: true ,
        appId: 'M2EXNAMR5IP0Klrd9CyjJmRU-gzGzoHsz',
        appKey: 'BAtmuQAdkaxDvaipyEKDw9NT',
        placeholder: '留下评论...',
        avatar: 'mm',
        meta: meta,
        pageSize: '10' || 10,
        visitor: false 
});
</script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-111347233-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </body>
</html>
